<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Resume - PDF</title>
    <style>
        @page {
            size: A4;
            margin: 0.4in;
        }
        
        @media print {
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            font-size: 9pt;
            line-height: 1.35;
            color: #110223;
            max-width: 8.27in;
            margin: 0 auto;
            padding: 0.4in;
            background: white;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 10pt;
        }
        
        .name {
            font-size: 24pt;
            font-weight: bold;
            color: #1C033C;
            margin-bottom: 6pt;
        }
        
        .contact {
            color: #371e77;
            font-size: 9pt;
        }
        
        .contact a {
            color: #371e77;
            text-decoration: underline;
        }
        
        .contact .sep {
            margin: 0 6pt;
        }
        
        /* Sections */
        .section {
            margin-top: 8pt;
            margin-bottom: 6pt;
        }
        
        .section-title {
            font-size: 11pt;
            font-weight: bold;
            letter-spacing: 0.5pt;
            color: #1C033C;
            border-bottom: 1pt solid #1C033C;
            padding-bottom: 2pt;
            margin-bottom: 5pt;
        }
        
        /* Skills */
        .skills-item {
            margin-bottom: 3pt;
        }
        
        .skills-category {
            font-weight: bold;
            color: #1C033C;
        }
        
        /* Experience */
        .experience-item {
            margin-bottom: 10pt;
        }
        
        .exp-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
        }
        
        .company {
            font-weight: bold;
            color: #1C033C;
        }
        
        .dates {
            color: #371e77;
        }
        
        .job-title {
            font-style: italic;
            font-weight: bold;
            color: #371e77;
            margin-top: 4pt;
            margin-bottom: 5pt;
        }
        
        ul.bullets {
            margin-left: 2em;
            padding-left: 0;
        }
        
        ul.bullets li {
            margin-bottom: 2pt;
        }
        
        .tech-stack {
            margin-left: 2em;
            margin-top: 3pt;
            color: #1C033C;
            font-size: 8.5pt;
        }
        
        /* Education */
        .education-item {
            margin-bottom: 6pt;
        }
        
        .edu-header {
            display: flex;
            justify-content: space-between;
        }
        
        .institution {
            font-weight: bold;
            color: #1C033C;
        }
        
        .degree-row {
            display: flex;
            justify-content: space-between;
        }
        
        .degree {
            color: #371e77;
        }
        
        .gpa {
            color: #4B28A4;
            font-weight: bold;
            font-style: italic;
        }
        
        .coursework {
            margin-top: 3pt;
            font-size: 8.5pt;
        }
        
        /* Projects */
        .project-name {
            font-weight: bold;
        }
        
        /* Print button - hide on print */
        .print-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        
        .print-controls button {
            padding: 12px 24px;
            background: #1C033C;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .print-controls button:hover {
            background: #371e77;
        }
        
        @media print {
            .print-controls { display: none; }
            body { padding: 0; }
        }
    </style>
</head>
<body>
    <div class="print-controls">
        <button onclick="savePDF()" style="background: #2563eb;">ðŸ“¥ Save as PDF (Best Quality)</button>
        <button onclick="window.location.href='/'">âœ• Close</button>
    </div>
    
    <div id="resume-content">
        <p style="text-align: center; color: #8b949e;">Loading resume...</p>
    </div>

    <script>
        function savePDF() {
            alert('To save as PDF with perfect quality:\n\n1. In the print dialog, select "Save as PDF" as the destination\n2. Click Save\n\nThis creates a true vector PDF that stays sharp at any zoom!');
            window.print();
        }

        async function loadAndRenderResume() {
            try {
                // Check URL parameter to determine which resume to load
                const urlParams = new URLSearchParams(window.location.search);
                const resumeType = urlParams.get('type') || 'tailored';
                const storageKey = resumeType === 'tailored' ? 'tailoredResumeData' : 'resumeData';
                
                const saved = localStorage.getItem(storageKey);
                if (!saved) {
                    throw new Error(`No ${resumeType} resume found. Please create your resume first.`);
                }
                const resume = JSON.parse(saved);
                renderResume(resume);
            } catch (e) {
                document.getElementById('resume-content').innerHTML = '<p style="color: red; text-align: center;">Failed to load resume</p>';
            }
        }

        function renderResume(resume) {
            let html = '';

            // Header
            html += `<div class="header">
                <div class="name">${resume.name || 'Your Name'}</div>
                <div class="contact">`;
            
            let contactParts = [];
            if (resume.contact?.email) contactParts.push(resume.contact.email);
            if (resume.contact?.phone) contactParts.push(resume.contact.phone);
            if (resume.contact?.github) contactParts.push(`<a href="https://${resume.contact.github}">${resume.contact.github}</a>`);
            if (resume.contact?.linkedin) contactParts.push(`<a href="https://${resume.contact.linkedin}">${resume.contact.linkedin}</a>`);
            
            html += contactParts.join('<span class="sep">|</span>');
            html += `</div></div>`;

            // Get custom section names or use defaults
            const sectionNames = resume.sectionNames || {
                skills: 'Skills',
                experience: 'Work Experience',
                education: 'Education',
                projects: 'Projects',
                awards: 'Awards & Certificates'
            };

            // Define section renderers
            const sectionRenderers = {
                skills: () => {
                    if (resume.skills && resume.skills.length > 0) {
                        let sectionHtml = `<div class="section"><div class="section-title">${sectionNames.skills || 'Skills'}</div>`;
                        resume.skills.forEach(skill => {
                            sectionHtml += `<div class="skills-item">
                                <span class="skills-category">${skill.category}:</span> ${skill.items}
                            </div>`;
                        });
                        sectionHtml += `</div>`;
                        return sectionHtml;
                    }
                    return '';
                },
                experience: () => {
                    const enabledExperiences = (resume.experience || []).filter(job => job.enabled !== false);
                    if (enabledExperiences.length > 0) {
                        let sectionHtml = `<div class="section"><div class="section-title">${sectionNames.experience || 'Work Experience'}</div>`;
                        enabledExperiences.forEach(job => {
                            sectionHtml += `<div class="experience-item">
                                <div class="exp-header">
                                    <span class="company">${job.company}${job.location ? ', ' + job.location : ''}</span>
                                    <span class="dates">${job.dates}</span>
                                </div>
                                <div class="job-title">${job.title}</div>`;
                            
                            if (job.bullets && job.bullets.length > 0) {
                                sectionHtml += `<ul class="bullets">`;
                                job.bullets.forEach(bullet => {
                                    sectionHtml += `<li>${bullet}</li>`;
                                });
                                sectionHtml += `</ul>`;
                            }
                            
                            if (job.techStack) {
                                sectionHtml += `<div class="tech-stack">${job.techStack}</div>`;
                            }
                            
                            sectionHtml += `</div>`;
                        });
                        sectionHtml += `</div>`;
                        return sectionHtml;
                    }
                    return '';
                },
                education: () => {
                    if (resume.education && resume.education.length > 0) {
                        let sectionHtml = `<div class="section"><div class="section-title">${sectionNames.education || 'Education'}</div>`;
                        const showGpa = resume.showGpa !== false; // Default to true if not set
                        resume.education.forEach(edu => {
                            sectionHtml += `<div class="education-item">
                                <div class="edu-header">
                                    <span class="institution">${edu.institution}</span>
                                    <span class="dates">${edu.dates}</span>
                                </div>
                                <div class="degree-row">
                                    <span class="degree">${edu.degree}</span>
                                    ${(showGpa && edu.gpa) ? `<span class="gpa">${edu.gpa}</span>` : ''}
                                </div>`;
                            
                            if (edu.coursework) {
                                sectionHtml += `<div class="coursework">Relevant Coursework: ${edu.coursework}</div>`;
                            }
                            
                            sectionHtml += `</div>`;
                        });
                        sectionHtml += `</div>`;
                        return sectionHtml;
                    }
                    return '';
                },
                projects: () => {
                    const enabledProjects = (resume.projects || []).filter(project => project.enabled !== false);
                    if (enabledProjects.length > 0) {
                        let sectionHtml = `<div class="section"><div class="section-title">${sectionNames.projects || 'Projects'}</div>`;
                        
                        enabledProjects.forEach(project => {
                            sectionHtml += `<div class="experience-item">
                                <div class="exp-header">
                                    <span class="company">${project.name}</span>
                                    ${project.year ? `<span class="dates">${project.year}</span>` : ''}
                                </div>`;
                            
                            // Check if using bullets or description
                            if (project.useBullets && project.bullets && project.bullets.length > 0) {
                                sectionHtml += `<ul class="bullets">`;
                                project.bullets.forEach(bullet => {
                                    sectionHtml += `<li>${bullet}</li>`;
                                });
                                sectionHtml += `</ul>`;
                            } else if (project.description) {
                                sectionHtml += `<div style="margin-top: 4pt;">${project.description}</div>`;
                            }
                            
                            sectionHtml += `</div>`;
                        });
                        
                        sectionHtml += `</div>`;
                        return sectionHtml;
                    }
                    return '';
                },
                awards: () => {
                    if (resume.awards && resume.awards.length > 0) {
                        // Filter enabled awards and handle both string and object formats
                        const enabledAwards = resume.awards.filter(award => {
                            if (typeof award === 'string') return true;
                            return award.enabled !== false;
                        });
                        
                        if (enabledAwards.length > 0) {
                            let sectionHtml = `<div class="section"><div class="section-title">${sectionNames.awards || 'Awards & Certificates'}</div><ul class="bullets">`;
                            enabledAwards.forEach(award => {
                                const awardName = typeof award === 'string' ? award : award.name;
                                sectionHtml += `<li>${awardName}</li>`;
                            });
                            sectionHtml += `</ul></div>`;
                            return sectionHtml;
                        }
                    }
                    return '';
                }
            };

            // Render sections in custom order if available, otherwise use default order
            const sectionOrder = resume.sectionOrder || ['skills', 'experience', 'education', 'projects', 'awards'];
            
            sectionOrder.forEach(sectionKey => {
                const renderer = sectionRenderers[sectionKey];
                if (renderer) {
                    html += renderer();
                }
            });

            document.getElementById('resume-content').innerHTML = html;
        }

        // Load resume on page load
        loadAndRenderResume();
    </script>
</body>
</html>

